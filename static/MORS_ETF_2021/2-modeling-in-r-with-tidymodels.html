<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Modeling in R with Tidymodels | Modeling in R and Python</title>
  <meta name="description" content="2 Modeling in R with Tidymodels | Modeling in R and Python" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Modeling in R with Tidymodels | Modeling in R and Python" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Modeling in R with Tidymodels | Modeling in R and Python" />
  
  
  

<meta name="author" content="MAJ Dusty Turner and Mr. Robert Ward" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="3-modeling-in-python-with-scikit-learn.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.19/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<center><li><a href = "https://dustysturner.com/MORS_ETF_2021/">Tutorial Home</a></li>
<img src="img/caa_seal.png" width="80"></center>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Class Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topics-class-structure"><i class="fa fa-check"></i><b>1.1</b> Topics &amp; Class Structure</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#software-prerequisites"><i class="fa fa-check"></i><b>1.2</b> Software Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#human-prerequisites"><i class="fa fa-check"></i><b>1.3</b> Human Prerequisites</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#tutorial-challenges"><i class="fa fa-check"></i><b>1.4</b> Tutorial Challenges</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#end-state"><i class="fa fa-check"></i><b>1.5</b> End State</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#instructors-introduction"><i class="fa fa-check"></i><b>1.6</b> Instructors Introduction</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#lets-get-started"><i class="fa fa-check"></i><b>1.7</b> Let’s Get Started…</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html"><i class="fa fa-check"></i><b>2</b> Modeling in R with Tidymodels</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#tidymodels-packages"><i class="fa fa-check"></i><b>2.1</b> Tidymodels Packages</a></li>
<li class="chapter" data-level="2.2" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#explore-data"><i class="fa fa-check"></i><b>2.2</b> Explore Data</a></li>
<li class="chapter" data-level="2.3" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#split-data"><i class="fa fa-check"></i><b>2.3</b> Split Data</a></li>
<li class="chapter" data-level="2.4" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#prepare-data"><i class="fa fa-check"></i><b>2.4</b> Prepare Data</a></li>
<li class="chapter" data-level="2.5" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#specify-model"><i class="fa fa-check"></i><b>2.5</b> Specify Model</a></li>
<li class="chapter" data-level="2.6" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#create-workflow"><i class="fa fa-check"></i><b>2.6</b> Create Workflow</a></li>
<li class="chapter" data-level="2.7" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#specify-grid-of-training-parameters"><i class="fa fa-check"></i><b>2.7</b> Specify Grid of Training Parameters</a></li>
<li class="chapter" data-level="2.8" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#train-model"><i class="fa fa-check"></i><b>2.8</b> Train Model</a></li>
<li class="chapter" data-level="2.9" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#build-model-on-all-training-data-test-on-validation-set"><i class="fa fa-check"></i><b>2.9</b> Build Model on all Training Data, Test on Validation Set</a></li>
<li class="chapter" data-level="2.10" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#change-model-to-random-forest"><i class="fa fa-check"></i><b>2.10</b> Change Model to Random Forest</a></li>
<li class="chapter" data-level="2.11" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#build-model-on-all-training-and-validation-data-using-the-best-model"><i class="fa fa-check"></i><b>2.11</b> Build Model on all Training and Validation Data Using the Best Model</a></li>
<li class="chapter" data-level="2.12" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#make-predictions-with-new-data"><i class="fa fa-check"></i><b>2.12</b> Make Predictions with New Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html"><i class="fa fa-check"></i><b>3</b> Modeling in Python with scikit-learn</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#scikit-learn-overview"><i class="fa fa-check"></i><b>3.1</b> scikit-learn Overview</a></li>
<li class="chapter" data-level="3.2" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#explore-data-1"><i class="fa fa-check"></i><b>3.2</b> Explore Data</a></li>
<li class="chapter" data-level="3.3" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#split-data-1"><i class="fa fa-check"></i><b>3.3</b> Split Data</a></li>
<li class="chapter" data-level="3.4" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#define-a-pipeline"><i class="fa fa-check"></i><b>3.4</b> Define a Pipeline</a></li>
<li class="chapter" data-level="3.5" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#fit-the-model-using-the-pipeline"><i class="fa fa-check"></i><b>3.5</b> Fit the Model (Using the Pipeline)</a></li>
<li class="chapter" data-level="3.6" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#score-and-evaluate-the-model"><i class="fa fa-check"></i><b>3.6</b> Score and Evaluate the Model</a></li>
<li class="chapter" data-level="3.7" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#try-another-method-random-forest"><i class="fa fa-check"></i><b>3.7</b> Try Another Method: Random Forest</a></li>
<li class="chapter" data-level="3.8" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#predict-on-eligible-data"><i class="fa fa-check"></i><b>3.8</b> Predict on Eligible Data</a></li>
<li class="chapter" data-level="3.9" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#conclusion"><i class="fa fa-check"></i><b>3.9</b> Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modeling in R and Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-in-r-with-tidymodels" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Modeling in R with Tidymodels</h1>
<p>“The tidymodels framework is a collection of packages for modeling and machine learning using tidyverse principles.”</p>
<p><a href="https://www.tidymodels.org/">https://www.tidymodels.org/</a></p>
<p>Many modeling techniques in R require different syntaxes and different data structures. Tidymodels provides a modeling workflow that standardizes syntaxes and data structures regardless of the model type.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="2-modeling-in-r-with-tidymodels.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>()</span>
<span id="cb3-2"><a href="2-modeling-in-r-with-tidymodels.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glm</span>()</span>
<span id="cb3-3"><a href="2-modeling-in-r-with-tidymodels.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glmnet</span>()</span>
<span id="cb3-4"><a href="2-modeling-in-r-with-tidymodels.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">randomForest</span>()</span>
<span id="cb3-5"><a href="2-modeling-in-r-with-tidymodels.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xgboost</span>()</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="2-modeling-in-r-with-tidymodels.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;linear_reg&quot;</span>, <span class="st">&quot;logistic_reg&quot;</span>, <span class="st">&quot;surv_reg&quot;</span>, <span class="st">&quot;multinom_reg&quot;</span>, <span class="st">&quot;rand_forest&quot;</span>, <span class="st">&quot;boost_tree&quot;</span>,</span>
<span id="cb4-2"><a href="2-modeling-in-r-with-tidymodels.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;svm_poly&quot;</span>, <span class="st">&quot;decision_tree&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="2-modeling-in-r-with-tidymodels.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="at">.f =</span> <span class="sc">~</span><span class="fu">show_engines</span>(<span class="at">x =</span> .x) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> .x)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="2-modeling-in-r-with-tidymodels.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-fcf9211eccbd3ee97023" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fcf9211eccbd3ee97023">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35"],["lm","glmnet","stan","spark","keras","glm","glmnet","LiblineaR","spark","keras","stan","flexsurv","survival","glmnet","spark","keras","nnet","ranger","ranger","randomForest","randomForest","spark","spark","xgboost","xgboost","C5.0","spark","spark","kernlab","kernlab","rpart","rpart","C5.0","spark","spark"],["regression","regression","regression","regression","regression","classification","classification","classification","classification","classification","classification","regression","regression","classification","classification","classification","classification","classification","regression","classification","regression","classification","regression","classification","regression","classification","classification","regression","classification","regression","classification","regression","classification","classification","regression"],["linear_reg","linear_reg","linear_reg","linear_reg","linear_reg","logistic_reg","logistic_reg","logistic_reg","logistic_reg","logistic_reg","logistic_reg","surv_reg","surv_reg","multinom_reg","multinom_reg","multinom_reg","multinom_reg","rand_forest","rand_forest","rand_forest","rand_forest","rand_forest","rand_forest","boost_tree","boost_tree","boost_tree","boost_tree","boost_tree","svm_poly","svm_poly","decision_tree","decision_tree","decision_tree","decision_tree","decision_tree"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>engine<\/th>\n      <th>mode<\/th>\n      <th>type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
<div id="tidymodels-packages" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Tidymodels Packages</h2>
<p>Like the tidyverse, tidymodels is a ‘meta package’ consisting of the following packages:</p>
<ul>
<li>{<a href="https://rsample.tidymodels.org/">rsample</a>}: Creates different types of resamples and corresponding classes for analysis</li>
<li>{<a href="https://recipes.tidymodels.org/">recipes</a>}: Uses dplyr-like pipeable sequences of feature engineering steps to get data ready for modeling</li>
<li>{<a href="https://workflows.tidymodels.org/index.html">workflows</a>}: Creates an object that can bundle together your pre-processing, modeling, and post-processing steps</li>
<li>{<a href="https://parsnip.tidymodels.org/">parsnip</a>}: Provides a tidy, unified interface to models than can by used to try a range of models without getting bogged down in the syntactical minutiae of the underlying packages</li>
<li>{<a href="https://tune.tidymodels.org/">tune</a>}: Facilitates hyperparameter tuning for the tidymodels packages</li>
<li>{<a href="https://yardstick.tidymodels.org/index.html">yardstick</a>}: Estimates how well models are working using tidy data principles</li>
<li>{<a href="https://infer.tidymodels.org/index.html">infer</a>}: Performs statistical inference using an expressive statistical grammar that coheres with the tidyverse design framework</li>
</ul>
<div id="tidymodels-road-map" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Tidymodels Road Map</h3>
<p>What we plan to do:</p>
<ol style="list-style-type: decimal">
<li>Explore data
<ul>
<li>{dplyr} Manipulate data</li>
<li>{ggplot2} Visualize data</li>
</ul></li>
<li>Create model
<ul>
<li>{rsample} Split data into test/train</li>
<li>{recipes} Preprocess data</li>
<li>{parsnip} Specify model</li>
<li>{workflows} Create workflow</li>
<li>{tune} / {dials} Train and tune parameters</li>
<li>{parsnip} Finalize model</li>
<li>{yardstick} Validate model</li>
</ul></li>
<li>Predict on new data</li>
</ol>
</div>
<div id="modeling-goal" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Modeling Goal</h3>
<p>We would like to create a model to predict which future Major League Baseball players will make the Hall of Fame. We will use <code>historical</code> data to build a model and then use that model to predict who may make the Hall of Fame from the players in the <code>eligible</code> data.</p>
</div>
</div>
<div id="explore-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Explore Data</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="2-modeling-in-r-with-tidymodels.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="2-modeling-in-r-with-tidymodels.html#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="2-modeling-in-r-with-tidymodels.html#cb5-3" aria-hidden="true" tabindex="-1"></a>historical <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;01_data/historical_baseball.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="2-modeling-in-r-with-tidymodels.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inducted =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(inducted))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="2-modeling-in-r-with-tidymodels.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ab <span class="sc">&gt;</span> <span class="dv">250</span>)</span>
<span id="cb5-6"><a href="2-modeling-in-r-with-tidymodels.html#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="2-modeling-in-r-with-tidymodels.html#cb5-7" aria-hidden="true" tabindex="-1"></a>eligible <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;01_data/eligible_baseball.csv&quot;</span>) </span>
<span id="cb5-8"><a href="2-modeling-in-r-with-tidymodels.html#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="2-modeling-in-r-with-tidymodels.html#cb5-9" aria-hidden="true" tabindex="-1"></a>historical</span></code></pre></div>
<pre><code>## # A tibble: 2,664 x 15
##    player_id inducted     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so last_year
##    &lt;chr&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 aaronha01 1         3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383      1976
##  2 aaronto01 0          437   944   102   216    42     6    13    94     9     8    86   145      1971
##  3 abbated01 0          855  3044   355   772    99    43    11   324   142     0   289    16      1910
##  4 adairje01 0         1165  4019   378  1022   163    19    57   366    29    29   208   499      1970
##  5 adamsba01 0          482  1019    79   216    31    15     3    75     1     1    53   177      1926
##  6 adamsbe01 0          267   678    37   137    17     4     2    45     9     0    23    79      1919
##  7 adamsbo03 0         1281  4019   591  1082   188    49    37   303    67    30   414   447      1959
##  8 adamssp01 0         1424  5557   844  1588   249    48     9   394   154    50   453   223      1934
##  9 adcocjo01 0         1959  6606   823  1832   295    35   336  1122    20    25   594  1059      1966
## 10 ageeto01  0         1129  3912   558   999   170    27   130   433   167    81   342   918      1973
## # ... with 2,654 more rows</code></pre>
<p>The <code>historical</code> data contains career statistics for every baseball batter from 1880-2011 who no longer meets Hall of Fame eligibility requirements or has already made the Hall of Fame.</p>
<p>Hall of Fame Qualifications:</p>
<ul>
<li>Played at least 10 years</li>
<li>Retired for at least 5 years</li>
<li>Players have only 10 years of eligibility</li>
</ul>
<p>The <code>eligible</code> data contains everyone who is still eligible for the Hall of Fame.</p>
<p>You can see from the data below, the players who make the Hall of Fame tend to perform better in a few standard baseball statistics.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="2-modeling-in-r-with-tidymodels.html#cb7-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="2-modeling-in-r-with-tidymodels.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>last_year) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="2-modeling-in-r-with-tidymodels.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(inducted) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="2-modeling-in-r-with-tidymodels.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">mean</span>(.),<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="2-modeling-in-r-with-tidymodels.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="do">## renders the table</span></span></code></pre></div>
<div id="zbmjqdayig" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#zbmjqdayig .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zbmjqdayig .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zbmjqdayig .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zbmjqdayig .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zbmjqdayig .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zbmjqdayig .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zbmjqdayig .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zbmjqdayig .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zbmjqdayig .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zbmjqdayig .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zbmjqdayig .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zbmjqdayig .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#zbmjqdayig .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zbmjqdayig .gt_from_md > :first-child {
  margin-top: 0;
}

#zbmjqdayig .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zbmjqdayig .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zbmjqdayig .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#zbmjqdayig .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbmjqdayig .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#zbmjqdayig .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbmjqdayig .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zbmjqdayig .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zbmjqdayig .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zbmjqdayig .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zbmjqdayig .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#zbmjqdayig .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zbmjqdayig .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#zbmjqdayig .gt_left {
  text-align: left;
}

#zbmjqdayig .gt_center {
  text-align: center;
}

#zbmjqdayig .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zbmjqdayig .gt_font_normal {
  font-weight: normal;
}

#zbmjqdayig .gt_font_bold {
  font-weight: bold;
}

#zbmjqdayig .gt_font_italic {
  font-style: italic;
}

#zbmjqdayig .gt_super {
  font-size: 65%;
}

#zbmjqdayig .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">inducted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">g</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ab</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">r</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">h</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">x2b</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">x3b</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">hr</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rbi</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sb</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">cs</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">bb</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">so</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_right">1675</td>
<td class="gt_row gt_right">5941</td>
<td class="gt_row gt_right">958</td>
<td class="gt_row gt_right">1747</td>
<td class="gt_row gt_right">295</td>
<td class="gt_row gt_right">77</td>
<td class="gt_row gt_right">149</td>
<td class="gt_row gt_right">874</td>
<td class="gt_row gt_right">165</td>
<td class="gt_row gt_right">37</td>
<td class="gt_row gt_right">643</td>
<td class="gt_row gt_right">564</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_right">907</td>
<td class="gt_row gt_right">2849</td>
<td class="gt_row gt_right">374</td>
<td class="gt_row gt_right">751</td>
<td class="gt_row gt_right">122</td>
<td class="gt_row gt_right">28</td>
<td class="gt_row gt_right">50</td>
<td class="gt_row gt_right">336</td>
<td class="gt_row gt_right">60</td>
<td class="gt_row gt_right">20</td>
<td class="gt_row gt_right">264</td>
<td class="gt_row gt_right">325</td></tr>
  </tbody>
  
  
</table>
</div>
<p>The plot of the data supports this as well.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="2-modeling-in-r-with-tidymodels.html#cb8-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="2-modeling-in-r-with-tidymodels.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(g<span class="sc">:</span>so) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="2-modeling-in-r-with-tidymodels.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> inducted, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb8-4"><a href="2-modeling-in-r-with-tidymodels.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb8-5"><a href="2-modeling-in-r-with-tidymodels.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)  <span class="sc">+</span></span>
<span id="cb8-6"><a href="2-modeling-in-r-with-tidymodels.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;&quot;</span>,<span class="at">x =</span> <span class="st">&quot;Hall of Fame Indicator&quot;</span>)</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Of note, we are dealing with imbalance classes, which will take unique considerations. To have a quality model, we hope to achieve greater than ~93% accuracy since this is what we could do by simply saying that no one should be in the Hall of Fame.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="2-modeling-in-r-with-tidymodels.html#cb9-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="2-modeling-in-r-with-tidymodels.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inducted) <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="2-modeling-in-r-with-tidymodels.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percent =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n),<span class="dv">4</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="st">&quot;%&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="2-modeling-in-r-with-tidymodels.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()  <span class="do">## renders the table</span></span></code></pre></div>
<div id="xnnwubadwm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xnnwubadwm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xnnwubadwm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnnwubadwm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xnnwubadwm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xnnwubadwm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnnwubadwm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xnnwubadwm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xnnwubadwm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xnnwubadwm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xnnwubadwm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xnnwubadwm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xnnwubadwm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xnnwubadwm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xnnwubadwm .gt_from_md > :first-child {
  margin-top: 0;
}

#xnnwubadwm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xnnwubadwm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xnnwubadwm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xnnwubadwm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnnwubadwm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xnnwubadwm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xnnwubadwm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xnnwubadwm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xnnwubadwm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xnnwubadwm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnnwubadwm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xnnwubadwm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xnnwubadwm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xnnwubadwm .gt_left {
  text-align: left;
}

#xnnwubadwm .gt_center {
  text-align: center;
}

#xnnwubadwm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xnnwubadwm .gt_font_normal {
  font-weight: normal;
}

#xnnwubadwm .gt_font_bold {
  font-weight: bold;
}

#xnnwubadwm .gt_font_italic {
  font-style: italic;
}

#xnnwubadwm .gt_super {
  font-size: 65%;
}

#xnnwubadwm .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">inducted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Percent</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_center">1</td>
<td class="gt_row gt_right">232</td>
<td class="gt_row gt_left">8.71%</td></tr>
    <tr><td class="gt_row gt_center">0</td>
<td class="gt_row gt_right">2432</td>
<td class="gt_row gt_left">91.29%</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="split-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Split Data</h2>
<p>To begin the analysis, we will load the {tidymodels} library.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="2-modeling-in-r-with-tidymodels.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code></pre></div>
<p>We will split the data into a training (two-thirds of the data) and testing set (one-third) of the data.</p>
<p>We set the seed so the analysis is reproducible.</p>
<p>The output of this function is an rsplit object. An rsplit object is one that can be used with the training and testing functions to extract the data in each split.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="2-modeling-in-r-with-tidymodels.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb11-2"><a href="2-modeling-in-r-with-tidymodels.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="2-modeling-in-r-with-tidymodels.html#cb11-3" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(historical, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">strata =</span> inducted)</span>
<span id="cb11-4"><a href="2-modeling-in-r-with-tidymodels.html#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="2-modeling-in-r-with-tidymodels.html#cb11-5" aria-hidden="true" tabindex="-1"></a>data_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;1776/888/2664&gt;</code></pre>
<p>We can extract the data from the rsplit object.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="2-modeling-in-r-with-tidymodels.html#cb13-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb13-2"><a href="2-modeling-in-r-with-tidymodels.html#cb13-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span>
<span id="cb13-3"><a href="2-modeling-in-r-with-tidymodels.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="2-modeling-in-r-with-tidymodels.html#cb13-4" aria-hidden="true" tabindex="-1"></a>train_data</span></code></pre></div>
<pre><code>## # A tibble: 1,776 x 15
##    player_id inducted     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so last_year
##    &lt;chr&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 aaronha01 1         3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383      1976
##  2 aaronto01 0          437   944   102   216    42     6    13    94     9     8    86   145      1971
##  3 abbated01 0          855  3044   355   772    99    43    11   324   142     0   289    16      1910
##  4 adairje01 0         1165  4019   378  1022   163    19    57   366    29    29   208   499      1970
##  5 adamsbe01 0          267   678    37   137    17     4     2    45     9     0    23    79      1919
##  6 adamssp01 0         1424  5557   844  1588   249    48     9   394   154    50   453   223      1934
##  7 ageeto01  0         1129  3912   558   999   170    27   130   433   167    81   342   918      1973
##  8 aguaylu01 0          568  1104   142   260    43    10    37   109     7     5    94   220      1989
##  9 aguirha01 0          447   388    14    33     7     1     0    21     1     0    14   236      1970
## 10 ainsmed01 0         1078  3048   299   707   108    54    22   317    86    16   263   315      1924
## # ... with 1,766 more rows</code></pre>
<p>From the training data, we further split the data into a training set (two-thirds of the training data) and a validation set (one-third of the training data) for parameter tuning and model assessment.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="2-modeling-in-r-with-tidymodels.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb15-2"><a href="2-modeling-in-r-with-tidymodels.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="2-modeling-in-r-with-tidymodels.html#cb15-3" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(<span class="at">data =</span> train_data, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">strata =</span> inducted)</span>
<span id="cb15-4"><a href="2-modeling-in-r-with-tidymodels.html#cb15-4" aria-hidden="true" tabindex="-1"></a>validation_set</span></code></pre></div>
<pre><code>## # Validation Set Split (0.67/0.33)  using stratification 
## # A tibble: 1 x 2
##   splits             id        
##   &lt;list&gt;             &lt;chr&gt;     
## 1 &lt;split [1184/592]&gt; validation</code></pre>
</div>
<div id="prepare-data" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Prepare Data</h2>
<p>What preprocessing steps do you want to do to your data every time you model?</p>
<p>We need to specify the following things:</p>
<ul>
<li>Specify the modeling formula</li>
<li>Specify the ‘roles’ of each of the factors</li>
<li>Do all preprocessing steps</li>
</ul>
<p>In the {tidymodels} construct, we do this by creating a recipe.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="2-modeling-in-r-with-tidymodels.html#cb17-1" aria-hidden="true" tabindex="-1"></a>baseball_recipe <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="2-modeling-in-r-with-tidymodels.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(inducted <span class="sc">~</span> ., <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="2-modeling-in-r-with-tidymodels.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(player_id, <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="2-modeling-in-r-with-tidymodels.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="2-modeling-in-r-with-tidymodels.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="2-modeling-in-r-with-tidymodels.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb17-7"><a href="2-modeling-in-r-with-tidymodels.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(<span class="st">&quot;last_year&quot;</span>)</span>
<span id="cb17-8"><a href="2-modeling-in-r-with-tidymodels.html#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="2-modeling-in-r-with-tidymodels.html#cb17-9" aria-hidden="true" tabindex="-1"></a>baseball_recipe</span></code></pre></div>
<pre><code>## Recipe
## 
## Inputs:
## 
##       role #variables
##         ID          1
##    outcome          1
##  predictor         13
## 
## Operations:
## 
## Centering for all_numeric()
## Scaling for all_numeric()
## Sparse, unbalanced variable filter on all_numeric()
## Delete terms &quot;last_year&quot;</code></pre>
</div>
<div id="specify-model" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Specify Model</h2>
<p>Now that we’ve prepared our data, we need to specify the model we wish to execute.</p>
<p>Here we identify the model type, specify parameters that need tuning, and then set our desired ‘engine’ (essentially, the modeling algorithm).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="2-modeling-in-r-with-tidymodels.html#cb19-1" aria-hidden="true" tabindex="-1"></a>lr_mod <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="2-modeling-in-r-with-tidymodels.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="2-modeling-in-r-with-tidymodels.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb19-4"><a href="2-modeling-in-r-with-tidymodels.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="2-modeling-in-r-with-tidymodels.html#cb19-5" aria-hidden="true" tabindex="-1"></a>lr_mod</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="create-workflow" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Create Workflow</h2>
<p>Now that we’ve prepared the data and specified the model, we put it all together in a workflow.</p>
<p>In a workflow, we add the specified model and the preprocessing recipe.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="2-modeling-in-r-with-tidymodels.html#cb21-1" aria-hidden="true" tabindex="-1"></a>baseball_workflow <span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="2-modeling-in-r-with-tidymodels.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="2-modeling-in-r-with-tidymodels.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="2-modeling-in-r-with-tidymodels.html#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(baseball_recipe)</span>
<span id="cb21-5"><a href="2-modeling-in-r-with-tidymodels.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="2-modeling-in-r-with-tidymodels.html#cb21-6" aria-hidden="true" tabindex="-1"></a>baseball_workflow</span></code></pre></div>
<pre><code>## == Workflow =========================================================================================================================================
## Preprocessor: Recipe
## Model: logistic_reg()
## 
## -- Preprocessor -------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model --------------------------------------------------------------------------------------------------------------------------------------------
## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="specify-grid-of-training-parameters" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Specify Grid of Training Parameters</h2>
<p>This step not only executes the model building procedure, but also tunes the penalty hyperparameter by running the model with every penalty option in a specified search grid.</p>
<p>First, we specify the parameters and search grids that we’ll use for tuning.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="2-modeling-in-r-with-tidymodels.html#cb23-1" aria-hidden="true" tabindex="-1"></a>lr_reg_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb23-2"><a href="2-modeling-in-r-with-tidymodels.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="2-modeling-in-r-with-tidymodels.html#cb23-3" aria-hidden="true" tabindex="-1"></a>lr_reg_grid</span></code></pre></div>
<pre><code>## # A tibble: 30 x 1
##     penalty
##       &lt;dbl&gt;
##  1 0.0001  
##  2 0.000127
##  3 0.000161
##  4 0.000204
##  5 0.000259
##  6 0.000329
##  7 0.000418
##  8 0.000530
##  9 0.000672
## 10 0.000853
## # ... with 20 more rows</code></pre>
</div>
<div id="train-model" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Train Model</h2>
<p>Next, we use <code>tune_grid()</code> to execute the model one time for each parameter set. In this instance, this is 30 times.</p>
<p>This function has several arguments:</p>
<ul>
<li><code>grid</code>: The tibble we created that contains the parameters we have specified.</li>
<li><code>control</code>: Controls various aspects of the grid search process.</li>
<li><code>metrics</code>: Specifies the model quality metrics we wish to save for each model in cross validation.</li>
</ul>
<p>We also specify that we wish to save the performance metrics for each of the 30 iterations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="2-modeling-in-r-with-tidymodels.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb25-2"><a href="2-modeling-in-r-with-tidymodels.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="2-modeling-in-r-with-tidymodels.html#cb25-3" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="ot">&lt;-</span></span>
<span id="cb25-4"><a href="2-modeling-in-r-with-tidymodels.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  baseball_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="2-modeling-in-r-with-tidymodels.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(validation_set,</span>
<span id="cb25-6"><a href="2-modeling-in-r-with-tidymodels.html#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> lr_reg_grid, </span>
<span id="cb25-7"><a href="2-modeling-in-r-with-tidymodels.html#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, </span>
<span id="cb25-8"><a href="2-modeling-in-r-with-tidymodels.html#cb25-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb25-9"><a href="2-modeling-in-r-with-tidymodels.html#cb25-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">allow_par =</span> <span class="cn">FALSE</span>),</span>
<span id="cb25-10"><a href="2-modeling-in-r-with-tidymodels.html#cb25-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc, accuracy))</span>
<span id="cb25-11"><a href="2-modeling-in-r-with-tidymodels.html#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="2-modeling-in-r-with-tidymodels.html#cb25-12" aria-hidden="true" tabindex="-1"></a>lr_validation</span></code></pre></div>
<pre><code>## # Tuning results
## # Validation Set Split (0.67/0.33)  using stratification 
## # A tibble: 1 x 5
##   splits             id         .metrics          .notes           .predictions         
##   &lt;list&gt;             &lt;chr&gt;      &lt;list&gt;            &lt;list&gt;           &lt;list&gt;               
## 1 &lt;split [1184/592]&gt; validation &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [17,760 x 7]&gt;</code></pre>
<p>Here, we extract out the best 25 models based on accuracy and plot them versus the penalty from the tuning parameter grid.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="2-modeling-in-r-with-tidymodels.html#cb27-1" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="2-modeling-in-r-with-tidymodels.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="at">n =</span> <span class="dv">25</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="2-modeling-in-r-with-tidymodels.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="2-modeling-in-r-with-tidymodels.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> penalty, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb27-5"><a href="2-modeling-in-r-with-tidymodels.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb27-6"><a href="2-modeling-in-r-with-tidymodels.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb27-7"><a href="2-modeling-in-r-with-tidymodels.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>We select the smallest penalty that results in the highest accuracy.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="2-modeling-in-r-with-tidymodels.html#cb28-1" aria-hidden="true" tabindex="-1"></a>lr_best <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="2-modeling-in-r-with-tidymodels.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="2-modeling-in-r-with-tidymodels.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="2-modeling-in-r-with-tidymodels.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;accuracy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="2-modeling-in-r-with-tidymodels.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mean <span class="sc">==</span> <span class="fu">max</span>(mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="2-modeling-in-r-with-tidymodels.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>We show the Receiver Operator Characteristic (ROC) curve for the selected model.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="2-modeling-in-r-with-tidymodels.html#cb29-1" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="2-modeling-in-r-with-tidymodels.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="2-modeling-in-r-with-tidymodels.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="2-modeling-in-r-with-tidymodels.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="build-model-on-all-training-data-test-on-validation-set" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Build Model on all Training Data, Test on Validation Set</h2>
<p>Now that we’ve found the best parameter set, we need to apply this model to the entire training set.</p>
<p>We’ll make one tweak to our previous model specification: we specify our chosen penalty from the tuning process, instead of allowing the penalty to be tuned automatically.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="2-modeling-in-r-with-tidymodels.html#cb30-1" aria-hidden="true" tabindex="-1"></a>last_lr_mod <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="2-modeling-in-r-with-tidymodels.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">penalty =</span> lr_best<span class="sc">$</span>penalty, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="2-modeling-in-r-with-tidymodels.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb30-4"><a href="2-modeling-in-r-with-tidymodels.html#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="2-modeling-in-r-with-tidymodels.html#cb30-5" aria-hidden="true" tabindex="-1"></a>last_lr_mod</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = lr_best$penalty
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>We update our workflow to have the best parameter set with the function <code>finalize_workflow()</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="2-modeling-in-r-with-tidymodels.html#cb32-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="ot">&lt;-</span></span>
<span id="cb32-2"><a href="2-modeling-in-r-with-tidymodels.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  baseball_workflow <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="2-modeling-in-r-with-tidymodels.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lr_best)</span>
<span id="cb32-4"><a href="2-modeling-in-r-with-tidymodels.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="2-modeling-in-r-with-tidymodels.html#cb32-5" aria-hidden="true" tabindex="-1"></a>last_lr_workflow</span></code></pre></div>
<pre><code>## == Workflow =========================================================================================================================================
## Preprocessor: Recipe
## Model: logistic_reg()
## 
## -- Preprocessor -------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model --------------------------------------------------------------------------------------------------------------------------------------------
## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = 1e-04
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>We fit the model on the entire training set.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="2-modeling-in-r-with-tidymodels.html#cb34-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="ot">&lt;-</span></span>
<span id="cb34-2"><a href="2-modeling-in-r-with-tidymodels.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="2-modeling-in-r-with-tidymodels.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(data_split)</span></code></pre></div>
<p>We can see the performance of the model below in the next two outputs.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="2-modeling-in-r-with-tidymodels.html#cb35-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="2-modeling-in-r-with-tidymodels.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary         0.923 Preprocessor1_Model1
## 2 roc_auc  binary         0.767 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="2-modeling-in-r-with-tidymodels.html#cb37-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="2-modeling-in-r-with-tidymodels.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="2-modeling-in-r-with-tidymodels.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(historical, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="2-modeling-in-r-with-tidymodels.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(historical) <span class="sc">%&gt;%</span> </span>
<span id="cb37-5"><a href="2-modeling-in-r-with-tidymodels.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_class =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(<span class="fu">round</span>(.pred_1)))) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="2-modeling-in-r-with-tidymodels.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(inducted, pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction    1    0
##          1   76   10
##          0  156 2422</code></pre>
<p>And we can take a view look at the ROC curve of our final model.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="2-modeling-in-r-with-tidymodels.html#cb39-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="2-modeling-in-r-with-tidymodels.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb39-3"><a href="2-modeling-in-r-with-tidymodels.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="2-modeling-in-r-with-tidymodels.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="change-model-to-random-forest" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Change Model to Random Forest</h2>
<div id="update-model-type" class="section level3" number="2.10.1">
<h3><span class="header-section-number">2.10.1</span> Update Model Type</h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="2-modeling-in-r-with-tidymodels.html#cb40-1" aria-hidden="true" tabindex="-1"></a>rf_mod <span class="ot">&lt;-</span></span>
<span id="cb40-2"><a href="2-modeling-in-r-with-tidymodels.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">min_n =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="2-modeling-in-r-with-tidymodels.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb40-4"><a href="2-modeling-in-r-with-tidymodels.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="2-modeling-in-r-with-tidymodels.html#cb40-5" aria-hidden="true" tabindex="-1"></a>rf_mod</span></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Computational engine: randomForest</code></pre>
</div>
<div id="update-workflow" class="section level3" number="2.10.2">
<h3><span class="header-section-number">2.10.2</span> Update Workflow</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="2-modeling-in-r-with-tidymodels.html#cb42-1" aria-hidden="true" tabindex="-1"></a>baseball_workflow_rf <span class="ot">&lt;-</span></span>
<span id="cb42-2"><a href="2-modeling-in-r-with-tidymodels.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="2-modeling-in-r-with-tidymodels.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="2-modeling-in-r-with-tidymodels.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(baseball_recipe)</span>
<span id="cb42-5"><a href="2-modeling-in-r-with-tidymodels.html#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="2-modeling-in-r-with-tidymodels.html#cb42-6" aria-hidden="true" tabindex="-1"></a>baseball_workflow_rf</span></code></pre></div>
<pre><code>## == Workflow =========================================================================================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor -------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model --------------------------------------------------------------------------------------------------------------------------------------------
## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Computational engine: randomForest</code></pre>
</div>
<div id="update-tuning-parameters" class="section level3" number="2.10.3">
<h3><span class="header-section-number">2.10.3</span> Update Tuning Parameters</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="2-modeling-in-r-with-tidymodels.html#cb44-1" aria-hidden="true" tabindex="-1"></a>rf_reg_grid <span class="ot">&lt;-</span> dials<span class="sc">::</span><span class="fu">grid_latin_hypercube</span>(<span class="fu">mtry</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>)), <span class="fu">min_n</span>(), <span class="fu">trees</span>(), <span class="at">size =</span> <span class="dv">30</span>)</span>
<span id="cb44-2"><a href="2-modeling-in-r-with-tidymodels.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="2-modeling-in-r-with-tidymodels.html#cb44-3" aria-hidden="true" tabindex="-1"></a>rf_reg_grid</span></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##     mtry min_n trees
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     7    36  1267
##  2     7     4   111
##  3     9     5  1244
##  4     2    27   795
##  5     8    13  1934
##  6     4    24   832
##  7     2    22  1795
##  8    10    16   199
##  9     6    10   537
## 10     6     7    40
## # ... with 20 more rows</code></pre>
</div>
<div id="re-execute-cross-validation" class="section level3" number="2.10.4">
<h3><span class="header-section-number">2.10.4</span> Re Execute Cross Validation</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="2-modeling-in-r-with-tidymodels.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb46-2"><a href="2-modeling-in-r-with-tidymodels.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="2-modeling-in-r-with-tidymodels.html#cb46-3" aria-hidden="true" tabindex="-1"></a>rf_validation <span class="ot">&lt;-</span></span>
<span id="cb46-4"><a href="2-modeling-in-r-with-tidymodels.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  baseball_workflow_rf <span class="sc">%&gt;%</span> </span>
<span id="cb46-5"><a href="2-modeling-in-r-with-tidymodels.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(validation_set,</span>
<span id="cb46-6"><a href="2-modeling-in-r-with-tidymodels.html#cb46-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> rf_reg_grid, </span>
<span id="cb46-7"><a href="2-modeling-in-r-with-tidymodels.html#cb46-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, </span>
<span id="cb46-8"><a href="2-modeling-in-r-with-tidymodels.html#cb46-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb46-9"><a href="2-modeling-in-r-with-tidymodels.html#cb46-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">allow_par =</span> <span class="cn">FALSE</span>),</span>
<span id="cb46-10"><a href="2-modeling-in-r-with-tidymodels.html#cb46-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc, accuracy))</span>
<span id="cb46-11"><a href="2-modeling-in-r-with-tidymodels.html#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="2-modeling-in-r-with-tidymodels.html#cb46-12" aria-hidden="true" tabindex="-1"></a>rf_validation</span></code></pre></div>
<pre><code>## # Tuning results
## # Validation Set Split (0.67/0.33)  using stratification 
## # A tibble: 1 x 5
##   splits             id         .metrics          .notes           .predictions         
##   &lt;list&gt;             &lt;chr&gt;      &lt;list&gt;            &lt;list&gt;           &lt;list&gt;               
## 1 &lt;split [1184/592]&gt; validation &lt;tibble [60 x 7]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [17,760 x 9]&gt;</code></pre>
</div>
<div id="explore-tuning-parameters" class="section level3" number="2.10.5">
<h3><span class="header-section-number">2.10.5</span> Explore Tuning Parameters</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="2-modeling-in-r-with-tidymodels.html#cb48-1" aria-hidden="true" tabindex="-1"></a>rf_validation <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="2-modeling-in-r-with-tidymodels.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="2-modeling-in-r-with-tidymodels.html#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;accuracy&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="2-modeling-in-r-with-tidymodels.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mtry<span class="sc">:</span>min_n) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="2-modeling-in-r-with-tidymodels.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">best_mod =</span> mean <span class="sc">==</span> <span class="fu">max</span>(mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="2-modeling-in-r-with-tidymodels.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb48-7"><a href="2-modeling-in-r-with-tidymodels.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(alpha = 0.5, size = 1.5) +</span></span>
<span id="cb48-8"><a href="2-modeling-in-r-with-tidymodels.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> best_mod)) <span class="sc">+</span></span>
<span id="cb48-9"><a href="2-modeling-in-r-with-tidymodels.html#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-10"><a href="2-modeling-in-r-with-tidymodels.html#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>()) <span class="sc">+</span></span>
<span id="cb48-11"><a href="2-modeling-in-r-with-tidymodels.html#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Accuracy&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Best Model&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Random Forest Cross Validation Tuning Parameters&quot;</span>)</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="select-best-tuning-parameters-for-random-forest" class="section level3" number="2.10.6">
<h3><span class="header-section-number">2.10.6</span> Select Best Tuning Parameters for Random Forest</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="2-modeling-in-r-with-tidymodels.html#cb49-1" aria-hidden="true" tabindex="-1"></a>rf_best <span class="ot">&lt;-</span></span>
<span id="cb49-2"><a href="2-modeling-in-r-with-tidymodels.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  rf_validation <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="2-modeling-in-r-with-tidymodels.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb49-4"><a href="2-modeling-in-r-with-tidymodels.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;accuracy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="2-modeling-in-r-with-tidymodels.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="2-modeling-in-r-with-tidymodels.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="show-roc-curve-for-best-random-forest-model" class="section level3" number="2.10.7">
<h3><span class="header-section-number">2.10.7</span> Show ROC Curve for Best Random Forest Model</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="2-modeling-in-r-with-tidymodels.html#cb50-1" aria-hidden="true" tabindex="-1"></a>rf_validation <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="2-modeling-in-r-with-tidymodels.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> rf_best) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="2-modeling-in-r-with-tidymodels.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="2-modeling-in-r-with-tidymodels.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="2-modeling-in-r-with-tidymodels.html#cb51-1" aria-hidden="true" tabindex="-1"></a>last_rf_mod <span class="ot">&lt;-</span></span>
<span id="cb51-2"><a href="2-modeling-in-r-with-tidymodels.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">mtry =</span> rf_best<span class="sc">$</span>mtry, <span class="at">trees =</span> rf_best<span class="sc">$</span>trees, <span class="at">min_n =</span> rf_best<span class="sc">$</span>min_n) <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="2-modeling-in-r-with-tidymodels.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;randomForest&quot;</span>)</span>
<span id="cb51-4"><a href="2-modeling-in-r-with-tidymodels.html#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="2-modeling-in-r-with-tidymodels.html#cb51-5" aria-hidden="true" tabindex="-1"></a>last_rf_mod</span></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = rf_best$mtry
##   trees = rf_best$trees
##   min_n = rf_best$min_n
## 
## Computational engine: randomForest</code></pre>
<p>We update our workflow to have the best parameter set with the function <code>finalize_workflow()</code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="2-modeling-in-r-with-tidymodels.html#cb53-1" aria-hidden="true" tabindex="-1"></a>last_rf_workflow <span class="ot">&lt;-</span></span>
<span id="cb53-2"><a href="2-modeling-in-r-with-tidymodels.html#cb53-2" aria-hidden="true" tabindex="-1"></a>  baseball_workflow_rf <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="2-modeling-in-r-with-tidymodels.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(rf_best)</span>
<span id="cb53-4"><a href="2-modeling-in-r-with-tidymodels.html#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="2-modeling-in-r-with-tidymodels.html#cb53-5" aria-hidden="true" tabindex="-1"></a>last_rf_workflow</span></code></pre></div>
<pre><code>## == Workflow =========================================================================================================================================
## Preprocessor: Recipe
## Model: rand_forest()
## 
## -- Preprocessor -------------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model --------------------------------------------------------------------------------------------------------------------------------------------
## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 4
##   trees = 1034
##   min_n = 6
## 
## Computational engine: randomForest</code></pre>
<p>We fit the model on the entire training set.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="2-modeling-in-r-with-tidymodels.html#cb55-1" aria-hidden="true" tabindex="-1"></a>last_rf_fit <span class="ot">&lt;-</span></span>
<span id="cb55-2"><a href="2-modeling-in-r-with-tidymodels.html#cb55-2" aria-hidden="true" tabindex="-1"></a>  last_rf_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb55-3"><a href="2-modeling-in-r-with-tidymodels.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(data_split)</span></code></pre></div>
<p>We can see the performance of the model below in the next two outputs.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="2-modeling-in-r-with-tidymodels.html#cb56-1" aria-hidden="true" tabindex="-1"></a>last_rf_fit <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="2-modeling-in-r-with-tidymodels.html#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary         0.934 Preprocessor1_Model1
## 2 roc_auc  binary         0.909 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="2-modeling-in-r-with-tidymodels.html#cb58-1" aria-hidden="true" tabindex="-1"></a>last_rf_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="2-modeling-in-r-with-tidymodels.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="2-modeling-in-r-with-tidymodels.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(historical, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-4"><a href="2-modeling-in-r-with-tidymodels.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(historical) <span class="sc">%&gt;%</span> </span>
<span id="cb58-5"><a href="2-modeling-in-r-with-tidymodels.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_class =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(<span class="fu">round</span>(.pred_1)))) <span class="sc">%&gt;%</span> </span>
<span id="cb58-6"><a href="2-modeling-in-r-with-tidymodels.html#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(inducted, pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction    1    0
##          1  189    2
##          0   43 2430</code></pre>
<p>And we can take a view look at the ROC curve of our final model.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="2-modeling-in-r-with-tidymodels.html#cb60-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="2-modeling-in-r-with-tidymodels.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="2-modeling-in-r-with-tidymodels.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb60-4"><a href="2-modeling-in-r-with-tidymodels.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
</div>
</div>
<div id="build-model-on-all-training-and-validation-data-using-the-best-model" class="section level2" number="2.11">
<h2><span class="header-section-number">2.11</span> Build Model on all Training and Validation Data Using the Best Model</h2>
<p>Now, we can use the <code>fit()</code> function to build the model on the entire <code>historical</code> data.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="2-modeling-in-r-with-tidymodels.html#cb61-1" aria-hidden="true" tabindex="-1"></a>last_rf_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="2-modeling-in-r-with-tidymodels.html#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="2-modeling-in-r-with-tidymodels.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() </span></code></pre></div>
<pre><code>## parsnip model object
## 
## Fit time:  2.4s 
## 
## Call:
##  randomForest(x = maybe_data_frame(x), y = y, ntree = ~1034L,      mtry = min_cols(~4L, x), nodesize = min_rows(~6L, x)) 
##                Type of random forest: classification
##                      Number of trees: 1034
## No. of variables tried at each split: 4
## 
##         OOB estimate of  error rate: 5.78%
## Confusion matrix:
##     1    0 class.error
## 1 103  129  0.55603448
## 0  25 2407  0.01027961</code></pre>
</div>
<div id="make-predictions-with-new-data" class="section level2" number="2.12">
<h2><span class="header-section-number">2.12</span> Make Predictions with New Data</h2>
<p>Now that we have the model, we can make predictions on the <code>eligible</code> data.</p>
<p>How did we do?</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="2-modeling-in-r-with-tidymodels.html#cb63-1" aria-hidden="true" tabindex="-1"></a>last_rf_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb63-2"><a href="2-modeling-in-r-with-tidymodels.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="2-modeling-in-r-with-tidymodels.html#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(eligible, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="2-modeling-in-r-with-tidymodels.html#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(eligible) <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="2-modeling-in-r-with-tidymodels.html#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>.pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb63-6"><a href="2-modeling-in-r-with-tidymodels.html#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.pred_1 <span class="sc">&gt;</span>.<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="2-modeling-in-r-with-tidymodels.html#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;pred&quot;</span>), <span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="2-modeling-in-r-with-tidymodels.html#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(n = Inf) %&gt;% </span></span>
<span id="cb63-9"><a href="2-modeling-in-r-with-tidymodels.html#cb63-9" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-e078c8e6979a0dad16b4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e078c8e6979a0dad16b4">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55"],[0.971,0.958,0.957,0.934,0.927,0.926,0.923,0.922,0.918,0.913,0.899,0.884,0.841,0.829,0.798,0.791,0.782,0.765,0.763,0.749,0.742,0.721,0.708,0.686,0.684,0.669,0.648,0.639,0.608,0.591,0.585,0.574,0.552,0.515,0.512,0.512,0.511,0.511,0.51,0.51,0.5,0.491,0.469,0.461,0.46,0.45,0.437,0.432,0.418,0.414,0.413,0.413,0.409,0.406,0.405],[0.029,0.042,0.043,0.066,0.073,0.074,0.077,0.078,0.082,0.087,0.101,0.116,0.159,0.171,0.202,0.209,0.218,0.235,0.237,0.251,0.258,0.279,0.292,0.314,0.316,0.331,0.352,0.361,0.392,0.409,0.415,0.426,0.448,0.485,0.488,0.488,0.489,0.489,0.49,0.49,0.5,0.509,0.531,0.539,0.54,0.55,0.563,0.568,0.582,0.586,0.587,0.587,0.591,0.594,0.595],["palmera01","bondsba01","rodrial01","pujolal01","jonesch06","vizquom01","damonjo01","jeterde01","sheffga01","beltrca01","ramirma02","beltrad01","thomeji01","suzukic01","ortizda01","sosasa01","cabremi01","gonzalu01","finlest01","rolliji01","guerrvl01","heltoto01","mcgrifr01","loftoke01","kentje01","konerpa01","abreubo01","ramirar01","willibe02","francju01","giambja01","delgaca01","youngmi02","riverma01","stantmi02","timlimi01","hawkila01","plesada01","francjo01","hoffmtr01","walkela01","gonzaju03","olerujo01","tejadmi01","leeca01","galaran01","oroscje01","martied01","hunteto01","teixema01","hernaro01","mesajo01","rodrifr03","jacksmi02","jonesto02"],[2831,2986,2784,2426,2499,2968,2490,2747,2576,2457,2302,2720,2543,2500,2408,2354,2096,2591,2583,2275,2147,2247,2460,2103,2298,2349,2425,2194,2076,2527,2260,2035,1970,1115,1178,1059,1042,1064,1119,1035,1988,1689,2234,2171,2099,2257,1252,2055,2372,1862,1010,1023,920,1005,982],[10472,9847,10566,9138,8984,10586,9736,11195,9217,9301,8244,10295,8422,9689,8640,8813,7853,9157,9397,9294,8155,7962,8757,8120,8498,8393,8480,8136,7869,8677,7267,7283,7918,3,24,7,8,15,34,34,6907,6556,7592,8434,7983,8096,59,7213,8857,6936,2,2,2,28,19],[1663,2227,2021,1670,1619,1445,1668,1923,1636,1522,1544,1428,1583,1396,1419,1475,1321,1412,1443,1421,1328,1401,1349,1528,1320,1162,1453,1098,1366,1285,1227,1241,1137,0,3,0,0,0,2,1,1355,1061,1139,1230,1125,1195,3,1219,1296,1099,0,1,0,3,1],[3020,2935,3115,2825,2726,2877,2769,3465,2689,2617,2574,2942,2328,3030,2472,2408,2519,2591,2548,2455,2590,2519,2490,2428,2461,2340,2470,2303,2336,2586,2010,2038,2375,0,8,0,0,1,3,4,2160,1936,2239,2407,2273,2333,10,2247,2452,1862,1,0,1,5,4],[585,601,548,602,549,456,522,544,467,536,547,591,451,356,632,379,523,596,449,511,477,592,441,383,560,410,574,495,449,407,405,483,441,0,1,0,0,0,0,2,471,388,500,468,469,444,0,514,498,408,0,0,0,2,1],[38,77,31,16,38,77,109,66,27,78,20,36,26,96,19,45,17,68,124,115,46,37,24,116,47,8,59,24,55,54,9,18,60,0,0,0,0,0,0,0,62,25,13,23,19,32,0,15,39,18,0,0,0,0,0],[569,762,696,591,468,80,235,260,509,421,555,445,612,114,541,609,446,354,304,231,449,369,493,130,377,439,288,386,287,173,440,473,185,0,0,0,0,0,0,0,383,434,255,307,358,399,0,309,353,409,0,0,0,0,0],[1835,1996,2086,1817,1623,951,1139,1311,1676,1536,1831,1571,1699,760,1768,1667,1553,1439,1167,936,1496,1406,1550,781,1518,1412,1363,1417,1257,1194,1441,1512,1030,1,3,0,0,0,1,5,1311,1404,1230,1302,1363,1425,4,1261,1391,1298,0,0,0,1,0],[97,514,329,107,150,404,408,358,253,312,38,119,19,508,17,234,38,128,320,470,181,37,72,622,94,9,400,29,147,281,20,14,90,0,0,0,0,0,0,0,230,26,11,85,125,128,0,49,195,26,0,0,0,0,0],[40,141,76,41,46,167,103,97,104,49,33,42,20,116,9,107,20,87,118,105,94,29,38,160,60,4,128,18,87,107,12,8,30,0,0,0,0,0,0,0,76,19,14,38,47,81,0,30,99,7,0,0,0,0,0],[1353,2558,1338,1214,1512,1028,1003,1082,1475,1051,1329,775,1747,626,1319,929,1011,1155,844,813,737,1335,1305,945,801,921,1476,633,1069,917,1366,1109,575,1,1,0,0,0,0,0,913,457,1275,553,655,583,8,1283,661,918,0,1,0,1,1],[1348,1539,2287,1053,1409,1087,1257,1840,1171,1693,1813,1584,2548,1037,1750,2306,1516,1218,1299,1264,985,1175,1882,1016,1522,1391,1840,1238,1212,1341,1572,1745,1235,1,3,4,7,10,14,11,1231,1273,1016,1079,984,2003,25,1202,1741,1441,1,1,1,4,6],[2005,2007,2016,2016,2012,2012,2012,2014,2009,2016,2011,2016,2012,2016,2016,2007,2016,2008,2007,2016,2011,2013,2004,2007,2008,2014,2014,2015,2006,2007,2014,2009,2013,2013,2007,2008,2015,2003,2005,2010,2005,2005,2005,2013,2012,2004,2003,2004,2015,2016,2007,2007,2016,2004,2008]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.pred_1<\/th>\n      <th>.pred_0<\/th>\n      <th>player_id<\/th>\n      <th>g<\/th>\n      <th>ab<\/th>\n      <th>r<\/th>\n      <th>h<\/th>\n      <th>x2b<\/th>\n      <th>x3b<\/th>\n      <th>hr<\/th>\n      <th>rbi<\/th>\n      <th>sb<\/th>\n      <th>cs<\/th>\n      <th>bb<\/th>\n      <th>so<\/th>\n      <th>last_year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5,6,7,8,9,10,11,12,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="3-modeling-in-python-with-scikit-learn.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>

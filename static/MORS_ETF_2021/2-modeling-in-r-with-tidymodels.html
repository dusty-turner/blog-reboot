<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Modeling in R With Tidymodels | Modeling in R and Python</title>
  <meta name="description" content="2 Modeling in R With Tidymodels | Modeling in R and Python" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Modeling in R With Tidymodels | Modeling in R and Python" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Modeling in R With Tidymodels | Modeling in R and Python" />
  
  
  

<meta name="author" content="MAJ Dusty Turner and Mr Robert Ward" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="3-modeling-in-python-with-scikit-learn.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "https://cprobe.army.mil/shinyapps/CAA/MORS_ETF_2020/">Tutorial Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Class Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#topics-class-structure"><i class="fa fa-check"></i><b>1.1</b> Topics &amp; Class Structure</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#software-prerequisites"><i class="fa fa-check"></i><b>1.2</b> Software Prerequisites</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#human-prerequisites"><i class="fa fa-check"></i><b>1.3</b> Human Prerequisites</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#distance-learning-challenges"><i class="fa fa-check"></i><b>1.4</b> Distance Learning Challenges</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#endstate"><i class="fa fa-check"></i><b>1.5</b> Endstate</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#instructors-introduction"><i class="fa fa-check"></i><b>1.6</b> Instructors Introduction</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#lets-get-started"><i class="fa fa-check"></i><b>1.7</b> Lets Get Started…</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html"><i class="fa fa-check"></i><b>2</b> Modeling in R With Tidymodels</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#tidymodels-packages"><i class="fa fa-check"></i><b>2.1</b> Tidymodels Packages</a></li>
<li class="chapter" data-level="2.2" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#explore-data"><i class="fa fa-check"></i><b>2.2</b> Explore Data</a></li>
<li class="chapter" data-level="2.3" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#split-data"><i class="fa fa-check"></i><b>2.3</b> Split Data</a></li>
<li class="chapter" data-level="2.4" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#prepare-data"><i class="fa fa-check"></i><b>2.4</b> Prepare Data</a></li>
<li class="chapter" data-level="2.5" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#specify-model"><i class="fa fa-check"></i><b>2.5</b> Specify Model</a></li>
<li class="chapter" data-level="2.6" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#create-workflow"><i class="fa fa-check"></i><b>2.6</b> Create Workflow</a></li>
<li class="chapter" data-level="2.7" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#train-model-and-tune-parameters"><i class="fa fa-check"></i><b>2.7</b> Train Model and Tune Parameters</a></li>
<li class="chapter" data-level="2.8" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#build-model-on-all-training-data-test-on-validation-set"><i class="fa fa-check"></i><b>2.8</b> Build Model on all Training Data, Test on Validation Set</a></li>
<li class="chapter" data-level="2.9" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#build-model-on-all-training-and-validation-data"><i class="fa fa-check"></i><b>2.9</b> Build Model on all Training and Validation Data</a></li>
<li class="chapter" data-level="2.10" data-path="2-modeling-in-r-with-tidymodels.html"><a href="2-modeling-in-r-with-tidymodels.html#make-predictions-with-new-data"><i class="fa fa-check"></i><b>2.10</b> Make Predictions with New Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html"><i class="fa fa-check"></i><b>3</b> Modeling in Python with scikit-learn</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#scikit-learn-overview"><i class="fa fa-check"></i><b>3.1</b> Scikit-learn Overview</a></li>
<li class="chapter" data-level="3.2" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#explore-data-1"><i class="fa fa-check"></i><b>3.2</b> Explore Data</a></li>
<li class="chapter" data-level="3.3" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#split-data-1"><i class="fa fa-check"></i><b>3.3</b> Split Data</a></li>
<li class="chapter" data-level="3.4" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#define-a-pipeline"><i class="fa fa-check"></i><b>3.4</b> Define a Pipeline</a></li>
<li class="chapter" data-level="3.5" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#fit-the-model-using-the-pipeline"><i class="fa fa-check"></i><b>3.5</b> Fit the Model (Using the Pipeline)</a></li>
<li class="chapter" data-level="3.6" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#score-and-evaluate-the-model"><i class="fa fa-check"></i><b>3.6</b> Score and Evaluate the Model</a></li>
<li class="chapter" data-level="3.7" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#predict-on-eligible-data"><i class="fa fa-check"></i><b>3.7</b> Predict on Eligible Data</a></li>
<li class="chapter" data-level="3.8" data-path="3-modeling-in-python-with-scikit-learn.html"><a href="3-modeling-in-python-with-scikit-learn.html#conclusion"><i class="fa fa-check"></i><b>3.8</b> Conclusion</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Modeling in R and Python</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-in-r-with-tidymodels" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Modeling in R With Tidymodels</h1>
<p>“The tidymodels framework is a collection of packages for modeling and machine learning using tidyverse principles.”</p>
<p><a href="https://www.tidymodels.org/">https://www.tidymodels.org/</a></p>
<p>Many modeling techniques in R require different syntaxes and different data structures. Tidymodels provides a modeling workflow that standardizes syntaxes and data structures regardless of the model type.</p>
<div id="tidymodels-packages" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Tidymodels Packages</h2>
<p>Like the tidyverse, tidymodels is a ‘meta package’ consisting of the following packages:</p>
<ul>
<li>{<a href="https://rsample.tidymodels.org/">rsample</a>}: Creates different types of resamples and corresponding classes for analysis</li>
<li>{<a href="https://recipes.tidymodels.org/">recipes</a>}: Uses dplyr-like pipeable sequences of feature engineering steps to get data ready for modeling</li>
<li>{<a href="https://workflows.tidymodels.org/index.html">workflows</a>}: Creates an object that can bundle together your pre-processing, modeling, and post-processing steps</li>
<li>{<a href="https://parsnip.tidymodels.org/">parsnip</a>}: Provides a tidy, unified interface to models than can by used to try a range of models without getting bogged down in the syntactical minutiae of the underlying packages</li>
<li>{<a href="https://tune.tidymodels.org/">tune</a>}: Facilitates hyperparameter tuning for the tidymodels packages</li>
<li>{<a href="https://yardstick.tidymodels.org/index.html">yardstick</a>}: Estimates how well models are working using tidy data principles</li>
<li>{<a href="https://infer.tidymodels.org/index.html">infer</a>}: Performs statistical inference using an expressive statistical grammar that coheres with the tidyverse design framework</li>
</ul>
<div id="tidymodels-road-map" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Tidymodels Road Map</h3>
<p>What we plan to do:</p>
<ol style="list-style-type: decimal">
<li>Explore data</li>
<li>Create model
<ul>
<li>{rsample} Split data into test/train</li>
<li>{recipes} Preprocess data</li>
<li>{parsnip} Specify model</li>
<li>{workflows} Create workflow</li>
<li>{tune} / {dials} Train and tune parameters</li>
<li>{parsnip} Finalize model</li>
<li>{yardstick} Validate model</li>
</ul></li>
<li>Predict on new data</li>
</ol>
</div>
<div id="modeling-goal" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Modeling Goal</h3>
<p>We would like to create a model using the <code>historical</code> data and use that model to predict who may make the Hall of Fame in the <code>eligible</code> data.</p>
</div>
</div>
<div id="explore-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Explore Data</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="2-modeling-in-r-with-tidymodels.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="2-modeling-in-r-with-tidymodels.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="2-modeling-in-r-with-tidymodels.html#cb3-3" aria-hidden="true" tabindex="-1"></a>historical <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;01_data/historical_baseball.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="2-modeling-in-r-with-tidymodels.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inducted =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(inducted)))</span>
<span id="cb3-5"><a href="2-modeling-in-r-with-tidymodels.html#cb3-5" aria-hidden="true" tabindex="-1"></a>eligible <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;01_data/eligible_baseball.csv&quot;</span>) </span>
<span id="cb3-6"><a href="2-modeling-in-r-with-tidymodels.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="2-modeling-in-r-with-tidymodels.html#cb3-7" aria-hidden="true" tabindex="-1"></a>historical</span></code></pre></div>
<pre><code>## # A tibble: 3,235 x 15
##    player_id inducted     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so last_year
##    &lt;chr&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 aaronha01 1         3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383      1976
##  2 aaronto01 0          437   944   102   216    42     6    13    94     9     8    86   145      1971
##  3 aasedo01  0          448     5     0     0     0     0     0     0     0     0     0     3      1990
##  4 abbated01 0          855  3044   355   772    99    43    11   324   142     0   289    16      1910
##  5 abbotgl01 0          248     0     0     0     0     0     0     0     0     0     0     0      1984
##  6 abbotji01 0          263    21     0     2     0     0     0     3     0     0     0    10      1999
##  7 abernte02 0          681   181    12    25     3     0     0     9     0     0     6    74      1972
##  8 ackerji01 0          467    54     2     9     1     0     0     1     0     0     2    32      1992
##  9 adairje01 0         1165  4019   378  1022   163    19    57   366    29    29   208   499      1970
## 10 adamsba01 0          482  1019    79   216    31    15     3    75     1     1    53   177      1926
## # ... with 3,225 more rows</code></pre>
<p>The <code>historical</code> data contains career statistics for every baseball batter from 1880-2011 who no longer meets Hall of Fame eligibility requirements or has already made the Hall of Fame.</p>
<p>Hall of Fame Qualifications:</p>
<ul>
<li>Played at least 10 years</li>
<li>Retired for at least 5 years</li>
<li>Players have only 10 years of eligibility</li>
</ul>
<p>The <code>eligible</code> data contains everyone who is still eligible for the Hall of Fame.</p>
<p>You can see from the data below, the players who make the Hall of Fame tend to perform better in a few standard baseball statistics.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="2-modeling-in-r-with-tidymodels.html#cb5-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="2-modeling-in-r-with-tidymodels.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>last_year) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="2-modeling-in-r-with-tidymodels.html#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(inducted) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="2-modeling-in-r-with-tidymodels.html#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric), <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(<span class="fu">mean</span>(.),<span class="dv">0</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="2-modeling-in-r-with-tidymodels.html#cb5-5" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>() <span class="do">## renders the table</span></span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vtpbafcvgd .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vtpbafcvgd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vtpbafcvgd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vtpbafcvgd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vtpbafcvgd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vtpbafcvgd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vtpbafcvgd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vtpbafcvgd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vtpbafcvgd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vtpbafcvgd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vtpbafcvgd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vtpbafcvgd .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vtpbafcvgd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vtpbafcvgd .gt_from_md > :first-child {
  margin-top: 0;
}

#vtpbafcvgd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vtpbafcvgd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vtpbafcvgd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vtpbafcvgd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtpbafcvgd .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vtpbafcvgd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtpbafcvgd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vtpbafcvgd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vtpbafcvgd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vtpbafcvgd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vtpbafcvgd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vtpbafcvgd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vtpbafcvgd .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vtpbafcvgd .gt_left {
  text-align: left;
}

#vtpbafcvgd .gt_center {
  text-align: center;
}

#vtpbafcvgd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vtpbafcvgd .gt_font_normal {
  font-weight: normal;
}

#vtpbafcvgd .gt_font_bold {
  font-weight: bold;
}

#vtpbafcvgd .gt_font_italic {
  font-style: italic;
}

#vtpbafcvgd .gt_super {
  font-size: 65%;
}

#vtpbafcvgd .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vtpbafcvgd" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">inducted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">g</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">ab</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">r</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">h</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">x2b</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">x3b</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">hr</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rbi</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">sb</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">cs</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">bb</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">so</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_right">1649</td>
      <td class="gt_row gt_right">5794</td>
      <td class="gt_row gt_right">934</td>
      <td class="gt_row gt_right">1704</td>
      <td class="gt_row gt_right">288</td>
      <td class="gt_row gt_right">75</td>
      <td class="gt_row gt_right">146</td>
      <td class="gt_row gt_right">852</td>
      <td class="gt_row gt_right">161</td>
      <td class="gt_row gt_right">36</td>
      <td class="gt_row gt_right">627</td>
      <td class="gt_row gt_right">551</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">0</td>
      <td class="gt_row gt_right">792</td>
      <td class="gt_row gt_right">2330</td>
      <td class="gt_row gt_right">305</td>
      <td class="gt_row gt_right">612</td>
      <td class="gt_row gt_right">99</td>
      <td class="gt_row gt_right">23</td>
      <td class="gt_row gt_right">40</td>
      <td class="gt_row gt_right">273</td>
      <td class="gt_row gt_right">48</td>
      <td class="gt_row gt_right">16</td>
      <td class="gt_row gt_right">215</td>
      <td class="gt_row gt_right">269</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>The plot of the data supports this as well.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="2-modeling-in-r-with-tidymodels.html#cb6-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="2-modeling-in-r-with-tidymodels.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(g<span class="sc">:</span>so) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="2-modeling-in-r-with-tidymodels.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> inducted, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="2-modeling-in-r-with-tidymodels.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-5"><a href="2-modeling-in-r-with-tidymodels.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)  <span class="sc">+</span></span>
<span id="cb6-6"><a href="2-modeling-in-r-with-tidymodels.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;&quot;</span>,<span class="at">x =</span> <span class="st">&quot;Hall of Fame Indicator&quot;</span>)</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Of note, we are dealing with imbalance classes which will take unique considerations. To have a quality model, we hope to achieve greater than ~93% accuracy since this is what we could do by simply saying that no one should be in the Hall of Fame.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="2-modeling-in-r-with-tidymodels.html#cb7-1" aria-hidden="true" tabindex="-1"></a>historical <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="2-modeling-in-r-with-tidymodels.html#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(inducted) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="2-modeling-in-r-with-tidymodels.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percent =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n),<span class="dv">4</span>)<span class="sc">*</span><span class="dv">100</span>,<span class="st">&quot;%&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="2-modeling-in-r-with-tidymodels.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  gt<span class="sc">::</span><span class="fu">gt</span>()  <span class="do">## renders the table</span></span></code></pre></div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#htzwxqvcwd .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#htzwxqvcwd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#htzwxqvcwd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#htzwxqvcwd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#htzwxqvcwd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#htzwxqvcwd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#htzwxqvcwd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#htzwxqvcwd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#htzwxqvcwd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#htzwxqvcwd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#htzwxqvcwd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#htzwxqvcwd .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#htzwxqvcwd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#htzwxqvcwd .gt_from_md > :first-child {
  margin-top: 0;
}

#htzwxqvcwd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#htzwxqvcwd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#htzwxqvcwd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#htzwxqvcwd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#htzwxqvcwd .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#htzwxqvcwd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#htzwxqvcwd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#htzwxqvcwd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#htzwxqvcwd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#htzwxqvcwd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#htzwxqvcwd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#htzwxqvcwd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#htzwxqvcwd .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#htzwxqvcwd .gt_left {
  text-align: left;
}

#htzwxqvcwd .gt_center {
  text-align: center;
}

#htzwxqvcwd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#htzwxqvcwd .gt_font_normal {
  font-weight: normal;
}

#htzwxqvcwd .gt_font_bold {
  font-weight: bold;
}

#htzwxqvcwd .gt_font_italic {
  font-style: italic;
}

#htzwxqvcwd .gt_super {
  font-size: 65%;
}

#htzwxqvcwd .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="htzwxqvcwd" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">inducted</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">n</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Percent</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">238</td>
      <td class="gt_row gt_left">7.36%</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">0</td>
      <td class="gt_row gt_center">2997</td>
      <td class="gt_row gt_left">92.64%</td>
    </tr>
  </tbody>
  
  
</table></div>
</div>
<div id="split-data" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Split Data</h2>
<p>To begin the analysis, we will load the {tidymodels} library.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="2-modeling-in-r-with-tidymodels.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code></pre></div>
<p>We will split the data into a training (2/3s of the data) and testing set (1/3) of the data.</p>
<p>We set the seed so the analysis is reproducible.</p>
<p>The output of this function is an rsplit object. An rsplit object is one that can be used with the training and testing functions to extract the data in each split.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="2-modeling-in-r-with-tidymodels.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb9-2"><a href="2-modeling-in-r-with-tidymodels.html#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="2-modeling-in-r-with-tidymodels.html#cb9-3" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(historical, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">strata =</span> inducted)</span>
<span id="cb9-4"><a href="2-modeling-in-r-with-tidymodels.html#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="2-modeling-in-r-with-tidymodels.html#cb9-5" aria-hidden="true" tabindex="-1"></a>data_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;2156/1079/3235&gt;</code></pre>
<p>We can extract the data from the rsplit object.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="2-modeling-in-r-with-tidymodels.html#cb11-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb11-2"><a href="2-modeling-in-r-with-tidymodels.html#cb11-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span>
<span id="cb11-3"><a href="2-modeling-in-r-with-tidymodels.html#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="2-modeling-in-r-with-tidymodels.html#cb11-4" aria-hidden="true" tabindex="-1"></a>train_data</span></code></pre></div>
<pre><code>## # A tibble: 2,156 x 15
##    player_id inducted     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so last_year
##    &lt;chr&gt;     &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 aaronha01 1         3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383      1976
##  2 aaronto01 0          437   944   102   216    42     6    13    94     9     8    86   145      1971
##  3 aasedo01  0          448     5     0     0     0     0     0     0     0     0     0     3      1990
##  4 abbated01 0          855  3044   355   772    99    43    11   324   142     0   289    16      1910
##  5 abbotji01 0          263    21     0     2     0     0     0     3     0     0     0    10      1999
##  6 abernte02 0          681   181    12    25     3     0     0     9     0     0     6    74      1972
##  7 ackerji01 0          467    54     2     9     1     0     0     1     0     0     2    32      1992
##  8 adamsba01 0          482  1019    79   216    31    15     3    75     1     1    53   177      1926
##  9 adamsbo03 0         1281  4019   591  1082   188    49    37   303    67    30   414   447      1959
## 10 adamssp01 0         1424  5557   844  1588   249    48     9   394   154    50   453   223      1934
## # ... with 2,146 more rows</code></pre>
<p>From the training data, we further split the data into a training set (two-thirds of the training data) and a validation set (one-third of the training data) for parameter tuning and model assessment.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="2-modeling-in-r-with-tidymodels.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb13-2"><a href="2-modeling-in-r-with-tidymodels.html#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="2-modeling-in-r-with-tidymodels.html#cb13-3" aria-hidden="true" tabindex="-1"></a>validation_set <span class="ot">&lt;-</span> <span class="fu">validation_split</span>(<span class="at">data =</span> train_data, <span class="at">prop =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">strata =</span> inducted)</span>
<span id="cb13-4"><a href="2-modeling-in-r-with-tidymodels.html#cb13-4" aria-hidden="true" tabindex="-1"></a>validation_set</span></code></pre></div>
<pre><code>## # Validation Set Split (0.67/0.33)  using stratification 
## # A tibble: 1 x 2
##   splits             id        
##   &lt;list&gt;             &lt;chr&gt;     
## 1 &lt;split [1437/719]&gt; validation</code></pre>
</div>
<div id="prepare-data" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Prepare Data</h2>
<p>What preprocessing steps do you want to do to your data every time you model?</p>
<p>We need to specify the following things:</p>
<ul>
<li>Specify the modeling formula</li>
<li>Specify the ‘roles’ of each of the factors</li>
<li>Do all preprocessing steps</li>
</ul>
<p>In the {tidymodels} construct, we do this by creating a recipe.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="2-modeling-in-r-with-tidymodels.html#cb15-1" aria-hidden="true" tabindex="-1"></a>baseball_recipe <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="2-modeling-in-r-with-tidymodels.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(inducted <span class="sc">~</span> ., <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="2-modeling-in-r-with-tidymodels.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(player_id, <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="2-modeling-in-r-with-tidymodels.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-5"><a href="2-modeling-in-r-with-tidymodels.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-6"><a href="2-modeling-in-r-with-tidymodels.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_numeric</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="2-modeling-in-r-with-tidymodels.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(<span class="st">&quot;last_year&quot;</span>)</span>
<span id="cb15-8"><a href="2-modeling-in-r-with-tidymodels.html#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="2-modeling-in-r-with-tidymodels.html#cb15-9" aria-hidden="true" tabindex="-1"></a>baseball_recipe</span></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##         ID          1
##    outcome          1
##  predictor         13
## 
## Operations:
## 
## Centering for all_numeric()
## Scaling for all_numeric()
## Sparse, unbalanced variable filter on all_numeric()
## Delete terms &quot;last_year&quot;</code></pre>
</div>
<div id="specify-model" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Specify Model</h2>
<p>Now that we’ve prepared our data, we need to specify the model we wish to execute.</p>
<p>Here we identify the model type, specify parameters which need tuning, and then set our desired ‘engine’ (essentially, the modeling algorithm).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="2-modeling-in-r-with-tidymodels.html#cb17-1" aria-hidden="true" tabindex="-1"></a>lr_mod <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="2-modeling-in-r-with-tidymodels.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="2-modeling-in-r-with-tidymodels.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb17-4"><a href="2-modeling-in-r-with-tidymodels.html#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="2-modeling-in-r-with-tidymodels.html#cb17-5" aria-hidden="true" tabindex="-1"></a>lr_mod</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="create-workflow" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Create Workflow</h2>
<p>Now that we’ve prepared the data and specified the model, we put it all together in a workflow.</p>
<p>In a workflow, we add the specified model and the preprocessing recipe.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="2-modeling-in-r-with-tidymodels.html#cb19-1" aria-hidden="true" tabindex="-1"></a>baseball_workflow <span class="ot">&lt;-</span></span>
<span id="cb19-2"><a href="2-modeling-in-r-with-tidymodels.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="2-modeling-in-r-with-tidymodels.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="2-modeling-in-r-with-tidymodels.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(baseball_recipe)</span>
<span id="cb19-5"><a href="2-modeling-in-r-with-tidymodels.html#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="2-modeling-in-r-with-tidymodels.html#cb19-6" aria-hidden="true" tabindex="-1"></a>baseball_workflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================================================================================
## Preprocessor: Recipe
## Model: logistic_reg()
## 
## -- Preprocessor --------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model ---------------------------------------------------------------------------------------------------------------------------------------
## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="train-model-and-tune-parameters" class="section level2" number="2.7">
<h2><span class="header-section-number">2.7</span> Train Model and Tune Parameters</h2>
<p>This step not only executes the model building procedure, but also tunes the penalty hyperparameter by running the model with every penalty option in a specified search grid.</p>
<p>First we specify the parameters and search grids that we’ll use for tuning.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="2-modeling-in-r-with-tidymodels.html#cb21-1" aria-hidden="true" tabindex="-1"></a>lr_reg_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb21-2"><a href="2-modeling-in-r-with-tidymodels.html#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="2-modeling-in-r-with-tidymodels.html#cb21-3" aria-hidden="true" tabindex="-1"></a>lr_reg_grid</span></code></pre></div>
<pre><code>## # A tibble: 30 x 1
##     penalty
##       &lt;dbl&gt;
##  1 0.0001  
##  2 0.000127
##  3 0.000161
##  4 0.000204
##  5 0.000259
##  6 0.000329
##  7 0.000418
##  8 0.000530
##  9 0.000672
## 10 0.000853
## # ... with 20 more rows</code></pre>
<p>Next, we use <code>tune_grid()</code> to execute the model one time for each parameter set. In this instance, this is 30 times.</p>
<p>This function has several arguments:</p>
<ul>
<li><code>grid</code>: The tibble we created that contains the parameters we have specified.</li>
<li><code>control</code>: Controls various aspects of the grid search process.</li>
<li><code>metrics</code>: Specifies the model quality metrics we wish to save for each model in cross validation.</li>
</ul>
<p>We also specify that we wish to save the performance metrics for each of the 30 iterations.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="2-modeling-in-r-with-tidymodels.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb23-2"><a href="2-modeling-in-r-with-tidymodels.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="2-modeling-in-r-with-tidymodels.html#cb23-3" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="ot">&lt;-</span></span>
<span id="cb23-4"><a href="2-modeling-in-r-with-tidymodels.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  baseball_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="2-modeling-in-r-with-tidymodels.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(validation_set,</span>
<span id="cb23-6"><a href="2-modeling-in-r-with-tidymodels.html#cb23-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> lr_reg_grid, </span>
<span id="cb23-7"><a href="2-modeling-in-r-with-tidymodels.html#cb23-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>, </span>
<span id="cb23-8"><a href="2-modeling-in-r-with-tidymodels.html#cb23-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">verbose =</span> <span class="cn">TRUE</span>, </span>
<span id="cb23-9"><a href="2-modeling-in-r-with-tidymodels.html#cb23-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">allow_par =</span> <span class="cn">FALSE</span>),</span>
<span id="cb23-10"><a href="2-modeling-in-r-with-tidymodels.html#cb23-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc, accuracy))</span>
<span id="cb23-11"><a href="2-modeling-in-r-with-tidymodels.html#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="2-modeling-in-r-with-tidymodels.html#cb23-12" aria-hidden="true" tabindex="-1"></a>lr_validation</span></code></pre></div>
<pre><code>## # Tuning results
## # Validation Set Split (0.67/0.33)  using stratification 
## # A tibble: 1 x 5
##   splits             id         .metrics          .notes           .predictions         
##   &lt;list&gt;             &lt;chr&gt;      &lt;list&gt;            &lt;list&gt;           &lt;list&gt;               
## 1 &lt;split [1437/719]&gt; validation &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt; &lt;tibble [21,570 x 7]&gt;</code></pre>
<p>Here, we extract out the best 25 models based on accuracy and plot them vs the penalty from the tuning parameter grid.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="2-modeling-in-r-with-tidymodels.html#cb25-1" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="2-modeling-in-r-with-tidymodels.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="at">n =</span> <span class="dv">25</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="2-modeling-in-r-with-tidymodels.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(penalty) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href="2-modeling-in-r-with-tidymodels.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> penalty, <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb25-5"><a href="2-modeling-in-r-with-tidymodels.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb25-6"><a href="2-modeling-in-r-with-tidymodels.html#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb25-7"><a href="2-modeling-in-r-with-tidymodels.html#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>We want the simplest possible model that retains very high accuracy. Because of that, we select the 7th smallest penalty.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="2-modeling-in-r-with-tidymodels.html#cb26-1" aria-hidden="true" tabindex="-1"></a>lr_best <span class="ot">&lt;-</span></span>
<span id="cb26-2"><a href="2-modeling-in-r-with-tidymodels.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="2-modeling-in-r-with-tidymodels.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="2-modeling-in-r-with-tidymodels.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">&quot;accuracy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="2-modeling-in-r-with-tidymodels.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">7</span>)</span></code></pre></div>
<p>We show the ROC curve for the selected model.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="2-modeling-in-r-with-tidymodels.html#cb27-1" aria-hidden="true" tabindex="-1"></a>lr_validation <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="2-modeling-in-r-with-tidymodels.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>(<span class="at">parameters =</span> lr_best) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="2-modeling-in-r-with-tidymodels.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="2-modeling-in-r-with-tidymodels.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="build-model-on-all-training-data-test-on-validation-set" class="section level2" number="2.8">
<h2><span class="header-section-number">2.8</span> Build Model on all Training Data, Test on Validation Set</h2>
<p>Now that we’ve found the best parameter set, we need to apply this model to the entire training set.</p>
<p>We’ll make one tweak to our previous model specification: we specify our chosen penalty from the tuning process, instead of allowing the penalty to be tuned automatically.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="2-modeling-in-r-with-tidymodels.html#cb28-1" aria-hidden="true" tabindex="-1"></a>last_lr_mod <span class="ot">&lt;-</span></span>
<span id="cb28-2"><a href="2-modeling-in-r-with-tidymodels.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>(<span class="at">mode =</span> <span class="st">&quot;classification&quot;</span>, <span class="at">penalty =</span> lr_best<span class="sc">$</span>penalty, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="2-modeling-in-r-with-tidymodels.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb28-4"><a href="2-modeling-in-r-with-tidymodels.html#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="2-modeling-in-r-with-tidymodels.html#cb28-5" aria-hidden="true" tabindex="-1"></a>last_lr_mod</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = lr_best$penalty
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>We update our workflow to have the best parameter set with the function <code>finalize_workflow()</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="2-modeling-in-r-with-tidymodels.html#cb30-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="ot">&lt;-</span></span>
<span id="cb30-2"><a href="2-modeling-in-r-with-tidymodels.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  baseball_workflow <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="2-modeling-in-r-with-tidymodels.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lr_best)</span>
<span id="cb30-4"><a href="2-modeling-in-r-with-tidymodels.html#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="2-modeling-in-r-with-tidymodels.html#cb30-5" aria-hidden="true" tabindex="-1"></a>last_lr_workflow</span></code></pre></div>
<pre><code>## == Workflow ====================================================================================================================================
## Preprocessor: Recipe
## Model: logistic_reg()
## 
## -- Preprocessor --------------------------------------------------------------------------------------------------------------------------------
## 4 Recipe Steps
## 
## * step_center()
## * step_scale()
## * step_nzv()
## * step_rm()
## 
## -- Model ---------------------------------------------------------------------------------------------------------------------------------------
## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = 0.00041753189365604
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<p>We fit the model on the entire training set.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="2-modeling-in-r-with-tidymodels.html#cb32-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="ot">&lt;-</span></span>
<span id="cb32-2"><a href="2-modeling-in-r-with-tidymodels.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="2-modeling-in-r-with-tidymodels.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(data_split)</span></code></pre></div>
<p>We can see the performance of the model below in the next two outputs.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="2-modeling-in-r-with-tidymodels.html#cb33-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="2-modeling-in-r-with-tidymodels.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;fct&gt;               
## 1 accuracy binary         0.947 Preprocessor1_Model1
## 2 roc_auc  binary         0.778 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="2-modeling-in-r-with-tidymodels.html#cb35-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="2-modeling-in-r-with-tidymodels.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="2-modeling-in-r-with-tidymodels.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(historical, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="2-modeling-in-r-with-tidymodels.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(historical) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="2-modeling-in-r-with-tidymodels.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_class =</span> <span class="fu">fct_rev</span>(<span class="fu">as.factor</span>(<span class="fu">round</span>(.pred_1)))) <span class="sc">%&gt;%</span> </span>
<span id="cb35-6"><a href="2-modeling-in-r-with-tidymodels.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(inducted, pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction    1    0
##          1   77   12
##          0  161 2985</code></pre>
<p>And we can take a view look at the ROC curve of our final model.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="2-modeling-in-r-with-tidymodels.html#cb37-1" aria-hidden="true" tabindex="-1"></a>last_lr_fit <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="2-modeling-in-r-with-tidymodels.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="2-modeling-in-r-with-tidymodels.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(inducted, .pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="2-modeling-in-r-with-tidymodels.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="MORS-ETF-2021_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="build-model-on-all-training-and-validation-data" class="section level2" number="2.9">
<h2><span class="header-section-number">2.9</span> Build Model on all Training and Validation Data</h2>
<p>Now, we can use the <code>fit()</code> function to build the model on the entire <code>historical</code> data.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="2-modeling-in-r-with-tidymodels.html#cb38-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="2-modeling-in-r-with-tidymodels.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="2-modeling-in-r-with-tidymodels.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="2-modeling-in-r-with-tidymodels.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 13 x 3
##    term        estimate  penalty
##    &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)   3.21   0.000418
##  2 g            -1.68   0.000418
##  3 ab            3.11   0.000418
##  4 r            -1.43   0.000418
##  5 h            -0.988  0.000418
##  6 x2b           0      0.000418
##  7 x3b          -0.118  0.000418
##  8 hr            0      0.000418
##  9 rbi          -0.477  0.000418
## 10 sb            0      0.000418
## 11 cs            0.190  0.000418
## 12 bb            0.250  0.000418
## 13 so            0.0290 0.000418</code></pre>
</div>
<div id="make-predictions-with-new-data" class="section level2" number="2.10">
<h2><span class="header-section-number">2.10</span> Make Predictions with New Data</h2>
<p>Now that we have the model, we can make predictions on the <code>eligible</code> data.</p>
<p>How did we do?</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="2-modeling-in-r-with-tidymodels.html#cb40-1" aria-hidden="true" tabindex="-1"></a>last_lr_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="2-modeling-in-r-with-tidymodels.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> historical) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="2-modeling-in-r-with-tidymodels.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(eligible, <span class="at">type =</span> <span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="2-modeling-in-r-with-tidymodels.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(eligible) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="2-modeling-in-r-with-tidymodels.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>.pred_1) <span class="sc">%&gt;%</span> </span>
<span id="cb40-6"><a href="2-modeling-in-r-with-tidymodels.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.pred_1 <span class="sc">&gt;</span>.<span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="2-modeling-in-r-with-tidymodels.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">&quot;pred&quot;</span>), <span class="sc">~</span><span class="fu">round</span>(.,<span class="dv">3</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="2-modeling-in-r-with-tidymodels.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(n = Inf) %&gt;% </span></span>
<span id="cb40-9"><a href="2-modeling-in-r-with-tidymodels.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code></pre></div>
<div id="htmlwidget-7bdb1af4e98e4826ba1c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7bdb1af4e98e4826ba1c">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],[0.946,0.906,0.809,0.792,0.747,0.745,0.734,0.675,0.661,0.649,0.628,0.623,0.596,0.592,0.535,0.528,0.525,0.509,0.508,0.499,0.496,0.483,0.478,0.435,0.427,0.424,0.421,0.417,0.409,0.402,0.401],[0.054,0.094,0.191,0.208,0.253,0.255,0.266,0.325,0.339,0.351,0.372,0.377,0.404,0.408,0.465,0.472,0.475,0.491,0.492,0.501,0.504,0.517,0.522,0.565,0.573,0.576,0.579,0.583,0.591,0.598,0.599],["bondsba01","rodrial01","pujolal01","ramirma02","thomeji01","palmera01","jonesch06","jeterde01","sheffga01","ortizda01","heltoto01","walkela01","cabremi01","beltrca01","beltrad01","guerrvl01","giambja01","gonzalu01","kentje01","sosasa01","damonjo01","mcgrifr01","delgaca01","edmonji01","abreubo01","francju01","martied01","finlest01","galaran01","aloumo01","burksel01"],[2986,2784,2426,2302,2543,2831,2499,2747,2576,2408,2247,1988,2096,2457,2720,2147,2260,2591,2298,2354,2490,2460,2035,2011,2425,2527,2055,2583,2257,1942,2000],[9847,10566,9138,8244,8422,10472,8984,11195,9217,8640,7962,6907,7853,9301,10295,8155,7267,9157,8498,8813,9736,8757,7283,6858,8480,8677,7213,9397,8096,7037,7232],[2227,2021,1670,1544,1583,1663,1619,1923,1636,1419,1401,1355,1321,1522,1428,1328,1227,1412,1320,1475,1668,1349,1241,1251,1453,1285,1219,1443,1195,1109,1253],[2935,3115,2825,2574,2328,3020,2726,3465,2689,2472,2519,2160,2519,2617,2942,2590,2010,2591,2461,2408,2769,2490,2038,1949,2470,2586,2247,2548,2333,2134,2107],[601,548,602,547,451,585,549,544,467,632,592,471,523,536,591,477,405,596,560,379,522,441,483,437,574,407,514,449,444,421,402],[77,31,16,20,26,38,38,66,27,19,37,62,17,78,36,46,9,68,47,45,109,24,18,25,59,54,15,124,32,39,63],[762,696,591,555,612,569,468,260,509,541,369,383,446,421,445,449,440,354,377,609,235,493,473,393,288,173,309,304,399,332,352],[1996,2086,1817,1831,1699,1835,1623,1311,1676,1768,1406,1311,1553,1536,1571,1496,1441,1439,1518,1667,1139,1550,1512,1199,1363,1194,1261,1167,1425,1287,1206],[514,329,107,38,19,97,150,358,253,17,37,230,38,312,119,181,20,128,94,234,408,72,14,67,400,281,49,320,128,106,181],[141,76,41,33,20,40,46,97,104,9,29,76,20,49,42,94,12,87,60,107,103,38,8,50,128,107,30,118,81,37,84],[2558,1338,1214,1329,1747,1353,1512,1082,1475,1319,1335,913,1011,1051,775,737,1366,1155,801,929,1003,1305,1109,998,1476,917,1283,844,583,737,793],[1539,2287,1053,1813,2548,1348,1409,1840,1171,1750,1175,1231,1516,1693,1584,985,1572,1218,1522,2306,1257,1882,1745,1729,1840,1341,1202,1299,2003,894,1340],[2007,2016,2016,2011,2012,2005,2012,2014,2009,2016,2013,2005,2016,2016,2016,2011,2014,2008,2008,2007,2012,2004,2009,2010,2014,2007,2004,2007,2004,2008,2004]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>.pred_1<\/th>\n      <th>.pred_0<\/th>\n      <th>player_id<\/th>\n      <th>g<\/th>\n      <th>ab<\/th>\n      <th>r<\/th>\n      <th>h<\/th>\n      <th>x2b<\/th>\n      <th>x3b<\/th>\n      <th>hr<\/th>\n      <th>rbi<\/th>\n      <th>sb<\/th>\n      <th>cs<\/th>\n      <th>bb<\/th>\n      <th>so<\/th>\n      <th>last_year<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,4,5,6,7,8,9,10,11,12,13,14,15,16]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="3-modeling-in-python-with-scikit-learn.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
